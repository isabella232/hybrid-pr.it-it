---
title: Modello di rilevamento calpestio con Azure e hub Azure Stack
description: Informazioni su come usare Azure e hub Azure Stack per implementare una soluzione di rilevamento calpestio basata su intelligenza artificiale per l'analisi del traffico del negozio al dettaglio.
author: BryanLa
ms.topic: article
ms.date: 10/31/2019
ms.author: bryanla
ms.reviewer: anajod
ms.lastreviewed: 10/31/2019
ms.openlocfilehash: 866557ec3af2337e9f034da84cf417675508563b
ms.sourcegitcommit: 962334135b63ac99c715e7bc8fb9282648ba63c9
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/23/2021
ms.locfileid: "104895330"
---
# <a name="footfall-detection-pattern"></a><span data-ttu-id="72eb2-103">Modello di rilevamento calpestio</span><span class="sxs-lookup"><span data-stu-id="72eb2-103">Footfall detection pattern</span></span>

<span data-ttu-id="72eb2-104">Questo modello offre una panoramica per l'implementazione di una soluzione di rilevamento calpestio basata su intelligenza artificiale per l'analisi del traffico dei visitatori nei negozi al dettaglio.</span><span class="sxs-lookup"><span data-stu-id="72eb2-104">This pattern provides an overview for implementing an AI-based footfall detection solution for analyzing visitor traffic in retail stores.</span></span> <span data-ttu-id="72eb2-105">La soluzione genera informazioni dettagliate da azioni reali, usando Azure, Hub Azure Stack e il Visione personalizzata AI Dev Kit.</span><span class="sxs-lookup"><span data-stu-id="72eb2-105">The solution generates insights from real world actions, using Azure, Azure Stack Hub, and the Custom Vision AI Dev Kit.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="72eb2-106">Contesto e problema</span><span class="sxs-lookup"><span data-stu-id="72eb2-106">Context and problem</span></span>

<span data-ttu-id="72eb2-107">Gli archivi di Contoso desiderano ottenere informazioni dettagliate sul modo in cui i clienti ricevono i prodotti correnti in relazione al layout dell'archivio.</span><span class="sxs-lookup"><span data-stu-id="72eb2-107">Contoso Stores would like to gain insights on how customers are receiving their current products in relation to store layout.</span></span> <span data-ttu-id="72eb2-108">Non sono in grado di collocare il personale in ogni sezione ed è inefficiente che un team di analisti esamini il metraggio della fotocamera di un intero negozio.</span><span class="sxs-lookup"><span data-stu-id="72eb2-108">They're unable to place staff in every section and it's inefficient to have a team of analysts review an entire store's camera footage.</span></span> <span data-ttu-id="72eb2-109">Inoltre, nessun negozio ha una larghezza di banda sufficiente per trasmettere video da tutte le relative fotocamere al cloud per l'analisi.</span><span class="sxs-lookup"><span data-stu-id="72eb2-109">In addition, none of their stores have enough bandwidth to stream video from all their cameras to the cloud for analysis.</span></span>

<span data-ttu-id="72eb2-110">Contoso desidera trovare un metodo non intrusivo e descrittivo per la privacy per determinare i dati demografici dei clienti, la lealtà e le reazioni per archiviare le visualizzazioni e i prodotti.</span><span class="sxs-lookup"><span data-stu-id="72eb2-110">Contoso would like to find an unobtrusive, privacy-friendly way to determine their customers' demographics, loyalty, and reactions to store displays and products.</span></span>

## <a name="solution"></a><span data-ttu-id="72eb2-111">Soluzione</span><span class="sxs-lookup"><span data-stu-id="72eb2-111">Solution</span></span>

<span data-ttu-id="72eb2-112">Questo modello di analisi delle vendite al dettaglio usa un approccio a più livelli per l'inferenza al perimetro.</span><span class="sxs-lookup"><span data-stu-id="72eb2-112">This retail analytics pattern uses a tiered approach to inferencing at the edge.</span></span> <span data-ttu-id="72eb2-113">Con Visione personalizzata AI Dev Kit vengono inviate solo le immagini con visi umani per l'analisi a un hub Azure Stack privato che esegue Servizi cognitivi di Azure.</span><span class="sxs-lookup"><span data-stu-id="72eb2-113">By using the Custom Vision AI Dev Kit, only images with human faces are sent for analysis to a private Azure Stack Hub that runs Azure Cognitive Services.</span></span> <span data-ttu-id="72eb2-114">Resi anonimi, i dati aggregati vengono inviati ad Azure per l'aggregazione in tutti i punti vendita e la visualizzazione in Power BI.</span><span class="sxs-lookup"><span data-stu-id="72eb2-114">Anonymized, aggregated data is sent to Azure for aggregation across all stores and visualization in Power BI.</span></span> <span data-ttu-id="72eb2-115">La combinazione di Edge e cloud pubblico permette a Contoso di sfruttare la tecnologia di intelligenza artificiale moderna, pur rimanendo in conformità con i criteri aziendali e rispettando la privacy dei clienti.</span><span class="sxs-lookup"><span data-stu-id="72eb2-115">Combining the edge and public cloud lets Contoso take advantage of modern AI technology while also remaining in compliance with their corporate policies and respecting their customers' privacy.</span></span>

<span data-ttu-id="72eb2-116">[![Soluzione modello di rilevamento calpestio](media/pattern-retail-footfall-detection/solution-architecture.png)](media/pattern-retail-footfall-detection/solution-architecture.png)</span><span class="sxs-lookup"><span data-stu-id="72eb2-116">[![Footfall detection pattern solution](media/pattern-retail-footfall-detection/solution-architecture.png)](media/pattern-retail-footfall-detection/solution-architecture.png)</span></span>

<span data-ttu-id="72eb2-117">Ecco un riepilogo del funzionamento della soluzione:</span><span class="sxs-lookup"><span data-stu-id="72eb2-117">Here's a summary of how the solution works:</span></span>

1. <span data-ttu-id="72eb2-118">Il Visione personalizzata AI Dev Kit ottiene una configurazione dall'hub Internet che installa il runtime IoT Edge e un modello ML.</span><span class="sxs-lookup"><span data-stu-id="72eb2-118">The Custom Vision AI Dev Kit gets a configuration from IoT Hub, which installs the IoT Edge Runtime and an ML model.</span></span>
2. <span data-ttu-id="72eb2-119">Se il modello vede una persona, acquisisce un'immagine e la carica nell'archivio BLOB dell'hub Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="72eb2-119">If the model sees a person, it takes a picture and uploads it to Azure Stack Hub blob storage.</span></span>
3. <span data-ttu-id="72eb2-120">Il servizio BLOB attiva una funzione di Azure nell'hub Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="72eb2-120">The blob service triggers an Azure Function on Azure Stack Hub.</span></span>
4. <span data-ttu-id="72eb2-121">La funzione di Azure chiama un contenitore con la API Viso per ottenere i dati demografici e di emozioni dall'immagine.</span><span class="sxs-lookup"><span data-stu-id="72eb2-121">The Azure Function calls a container with the Face API to get demographic and emotion data from the image.</span></span>
5. <span data-ttu-id="72eb2-122">I dati vengono resi anonimi e inviati a un cluster di hub eventi di Azure.</span><span class="sxs-lookup"><span data-stu-id="72eb2-122">The data is anonymized and sent to an Azure Event Hubs cluster.</span></span>
6. <span data-ttu-id="72eb2-123">Il cluster di hub eventi esegue il push dei dati in analisi di flusso.</span><span class="sxs-lookup"><span data-stu-id="72eb2-123">The Event Hubs cluster pushes the data to Stream Analytics.</span></span>
7. <span data-ttu-id="72eb2-124">Analisi di flusso aggrega i dati e li inserisce in Power BI.</span><span class="sxs-lookup"><span data-stu-id="72eb2-124">Stream Analytics aggregates the data and pushes it to Power BI.</span></span>

## <a name="components"></a><span data-ttu-id="72eb2-125">Componenti</span><span class="sxs-lookup"><span data-stu-id="72eb2-125">Components</span></span>

<span data-ttu-id="72eb2-126">Questa soluzione USA i componenti seguenti:</span><span class="sxs-lookup"><span data-stu-id="72eb2-126">This solution uses the following components:</span></span>

| <span data-ttu-id="72eb2-127">Livello</span><span class="sxs-lookup"><span data-stu-id="72eb2-127">Layer</span></span> | <span data-ttu-id="72eb2-128">Componente</span><span class="sxs-lookup"><span data-stu-id="72eb2-128">Component</span></span> | <span data-ttu-id="72eb2-129">Descrizione</span><span class="sxs-lookup"><span data-stu-id="72eb2-129">Description</span></span> |
|----------|-----------|-------------|
| <span data-ttu-id="72eb2-130">Hardware nell'archivio</span><span class="sxs-lookup"><span data-stu-id="72eb2-130">In-store hardware</span></span> | [<span data-ttu-id="72eb2-131">Visione personalizzata AI Dev Kit</span><span class="sxs-lookup"><span data-stu-id="72eb2-131">Custom Vision AI Dev Kit</span></span>](https://azure.github.io/Vision-AI-DevKit-Pages/) | <span data-ttu-id="72eb2-132">Consente di filtrare in archivio usando un modello di ML locale che acquisisce solo le immagini di persone per l'analisi.</span><span class="sxs-lookup"><span data-stu-id="72eb2-132">Provides in-store filtering using a local ML model that only captures images of people for analysis.</span></span> <span data-ttu-id="72eb2-133">Con provisioning e aggiornamento in modo sicuro tramite l'hub Internet.</span><span class="sxs-lookup"><span data-stu-id="72eb2-133">Securely provisioned and updated through IoT Hub.</span></span><br><br>|
| <span data-ttu-id="72eb2-134">Azure</span><span class="sxs-lookup"><span data-stu-id="72eb2-134">Azure</span></span> | [<span data-ttu-id="72eb2-135">Hub eventi di Azure</span><span class="sxs-lookup"><span data-stu-id="72eb2-135">Azure Event Hubs</span></span>](/azure/event-hubs/) | <span data-ttu-id="72eb2-136">Hub eventi di Azure offre una piattaforma scalabile per l'inserimento di dati resi anonimi che si integrano in modo accurato con analisi di flusso di Azure.</span><span class="sxs-lookup"><span data-stu-id="72eb2-136">Azure Event Hubs provides a scalable platform for ingesting anonymized data that integrates neatly with Azure Stream Analytics.</span></span> |
|  | [<span data-ttu-id="72eb2-137">Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="72eb2-137">Azure Stream Analytics</span></span>](/azure/stream-analytics/) | <span data-ttu-id="72eb2-138">Un processo di analisi di flusso di Azure aggrega i dati di resi anonimi e li raggruppa in finestre di 15 secondi per la visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="72eb2-138">An Azure Stream Analytics job aggregates the anonymized data and groups it into 15-second windows for visualization.</span></span> |
|  | [<span data-ttu-id="72eb2-139">Microsoft Power BI</span><span class="sxs-lookup"><span data-stu-id="72eb2-139">Microsoft Power BI</span></span>](https://powerbi.microsoft.com/) | <span data-ttu-id="72eb2-140">Power BI offre un'interfaccia Dashboard di facile utilizzo per la visualizzazione dell'output di analisi di flusso di Azure.</span><span class="sxs-lookup"><span data-stu-id="72eb2-140">Power BI provides an easy-to-use dashboard interface for viewing the output from Azure Stream Analytics.</span></span> |
| <span data-ttu-id="72eb2-141">Hub di Azure Stack</span><span class="sxs-lookup"><span data-stu-id="72eb2-141">Azure Stack Hub</span></span> | [<span data-ttu-id="72eb2-142">Servizio app</span><span class="sxs-lookup"><span data-stu-id="72eb2-142">App Service</span></span>](/azure-stack/operator/azure-stack-app-service-overview) | <span data-ttu-id="72eb2-143">Il provider di risorse del servizio app fornisce una base per i componenti perimetrali, incluse le funzionalità di hosting e gestione per app Web/API e funzioni.</span><span class="sxs-lookup"><span data-stu-id="72eb2-143">The App Service resource provider (RP) provides a base for edge components, including hosting and management features for web apps/APIs and Functions.</span></span> |
| | <span data-ttu-id="72eb2-144">Cluster del motore di Azure Kubernetes Service [(AKS)](https://github.com/Azure/aks-engine)</span><span class="sxs-lookup"><span data-stu-id="72eb2-144">Azure Kubernetes Service [(AKS) Engine](https://github.com/Azure/aks-engine) cluster</span></span> | <span data-ttu-id="72eb2-145">Il componente AKS RP con AKS-Engine cluster distribuito nell'hub Azure Stack fornisce un motore resiliente e scalabile per l'esecuzione del contenitore di API Viso.</span><span class="sxs-lookup"><span data-stu-id="72eb2-145">The AKS RP with AKS-Engine cluster deployed into Azure Stack Hub provides a scalable, resilient engine to run the Face API container.</span></span> |
| | <span data-ttu-id="72eb2-146">[Contenitori di API viso](/azure/cognitive-services/face/face-how-to-install-containers) di servizi cognitivi di Azure</span><span class="sxs-lookup"><span data-stu-id="72eb2-146">Azure Cognitive Services [Face API containers](/azure/cognitive-services/face/face-how-to-install-containers)</span></span>| <span data-ttu-id="72eb2-147">I servizi cognitivi di Azure RP con API Viso contenitori forniscono rilevamento demografico, emotivo e univoco dei visitatori sulla rete privata di contoso.</span><span class="sxs-lookup"><span data-stu-id="72eb2-147">The Azure Cognitive Services RP with Face API containers provides demographic, emotion, and unique visitor detection on Contoso's private network.</span></span> |
| | <span data-ttu-id="72eb2-148">Archiviazione BLOB</span><span class="sxs-lookup"><span data-stu-id="72eb2-148">Blob Storage</span></span> | <span data-ttu-id="72eb2-149">Le immagini acquisite da AI Dev Kit vengono caricate nell'archiviazione BLOB di Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="72eb2-149">Images captured from the AI Dev Kit are uploaded to Azure Stack Hub's blob storage.</span></span> |
| | <span data-ttu-id="72eb2-150">Funzioni di Azure</span><span class="sxs-lookup"><span data-stu-id="72eb2-150">Azure Functions</span></span> | <span data-ttu-id="72eb2-151">Una funzione di Azure in esecuzione nell'hub Azure Stack riceve l'input dall'archiviazione BLOB e gestisce le interazioni con l'API Viso.</span><span class="sxs-lookup"><span data-stu-id="72eb2-151">An Azure Function running on Azure Stack Hub receives input from blob storage and manages the interactions with the Face API.</span></span> <span data-ttu-id="72eb2-152">Emette i dati di resi anonimi a un cluster di hub eventi che si trova in Azure.</span><span class="sxs-lookup"><span data-stu-id="72eb2-152">It emits anonymized data to an Event Hubs cluster located in Azure.</span></span><br><br>|

## <a name="issues-and-considerations"></a><span data-ttu-id="72eb2-153">Considerazioni e problemi</span><span class="sxs-lookup"><span data-stu-id="72eb2-153">Issues and considerations</span></span>

<span data-ttu-id="72eb2-154">Quando si decide come implementare questa soluzione, tenere presente quanto segue:</span><span class="sxs-lookup"><span data-stu-id="72eb2-154">Consider the following points when deciding how to implement this solution:</span></span>

### <a name="scalability"></a><span data-ttu-id="72eb2-155">Scalabilità</span><span class="sxs-lookup"><span data-stu-id="72eb2-155">Scalability</span></span>

<span data-ttu-id="72eb2-156">Per consentire la scalabilità di questa soluzione tra più fotocamere e posizioni, è necessario assicurarsi che tutti i componenti siano in grado di gestire l'aumento del carico.</span><span class="sxs-lookup"><span data-stu-id="72eb2-156">To enable this solution to scale across multiple cameras and locations, you'll need to make sure that all of the components can handle the increased load.</span></span> <span data-ttu-id="72eb2-157">Potrebbe essere necessario eseguire azioni come:</span><span class="sxs-lookup"><span data-stu-id="72eb2-157">You may need to take actions like:</span></span>

- <span data-ttu-id="72eb2-158">Aumentare il numero di unità di streaming di analisi di flusso.</span><span class="sxs-lookup"><span data-stu-id="72eb2-158">Increase the number of Stream Analytics streaming units.</span></span>
- <span data-ttu-id="72eb2-159">Scalare in orizzontale la distribuzione di API Viso.</span><span class="sxs-lookup"><span data-stu-id="72eb2-159">Scale out the Face API deployment.</span></span>
- <span data-ttu-id="72eb2-160">Aumentare la velocità effettiva del cluster di hub eventi.</span><span class="sxs-lookup"><span data-stu-id="72eb2-160">Increase the Event Hubs cluster throughput.</span></span>
- <span data-ttu-id="72eb2-161">Per i casi estremi, potrebbe essere necessario eseguire la migrazione da funzioni di Azure a una macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="72eb2-161">For extreme cases, migrate from Azure Functions to a virtual machine may be necessary.</span></span>

### <a name="availability"></a><span data-ttu-id="72eb2-162">Disponibilità</span><span class="sxs-lookup"><span data-stu-id="72eb2-162">Availability</span></span>

<span data-ttu-id="72eb2-163">Poiché questa soluzione è a livelli, è importante considerare la modalità di gestione degli errori di rete o di alimentazione.</span><span class="sxs-lookup"><span data-stu-id="72eb2-163">Since this solution is tiered, it's important to think about how to deal with networking or power failures.</span></span> <span data-ttu-id="72eb2-164">A seconda delle esigenze aziendali, potrebbe essere necessario implementare un meccanismo per memorizzare nella cache le immagini localmente, quindi procedere all'hub Azure Stack al ritorno della connettività.</span><span class="sxs-lookup"><span data-stu-id="72eb2-164">Depending on business needs, you might want to implement a mechanism to cache images locally, then forward to Azure Stack Hub when connectivity returns.</span></span> <span data-ttu-id="72eb2-165">Se il percorso è sufficientemente grande, la distribuzione di un Data Box Edge con il contenitore di API Viso in tale posizione potrebbe essere un'opzione migliore.</span><span class="sxs-lookup"><span data-stu-id="72eb2-165">If the location is large enough, deploying a Data Box Edge with the Face API container to that location might be a better option.</span></span>

### <a name="manageability"></a><span data-ttu-id="72eb2-166">Gestione</span><span class="sxs-lookup"><span data-stu-id="72eb2-166">Manageability</span></span>

<span data-ttu-id="72eb2-167">Questa soluzione può estendersi a molti dispositivi e posizioni, che potrebbero essere difficili da gestire.</span><span class="sxs-lookup"><span data-stu-id="72eb2-167">This solution can span many devices and locations, which could get unwieldy.</span></span> <span data-ttu-id="72eb2-168">I servizi Internet delle cose di [Azure](/azure/iot-fundamentals/) possono essere usati per riunire automaticamente nuove posizioni e dispositivi e mantenerli aggiornati.</span><span class="sxs-lookup"><span data-stu-id="72eb2-168">[Azure's IoT services](/azure/iot-fundamentals/) can be used to automatically bring new locations and devices online and keep them up to date.</span></span>

### <a name="security"></a><span data-ttu-id="72eb2-169">Sicurezza</span><span class="sxs-lookup"><span data-stu-id="72eb2-169">Security</span></span>

<span data-ttu-id="72eb2-170">Questa soluzione acquisisce le immagini dei clienti, prendendo in considerazione la sicurezza.</span><span class="sxs-lookup"><span data-stu-id="72eb2-170">This solution captures customer images, making security a paramount consideration.</span></span> <span data-ttu-id="72eb2-171">Verificare che tutti gli account di archiviazione siano protetti con i criteri di accesso appropriati e ruotare periodicamente le chiavi.</span><span class="sxs-lookup"><span data-stu-id="72eb2-171">Make sure all storage accounts are secured with the proper access policies and rotate keys regularly.</span></span> <span data-ttu-id="72eb2-172">Verificare che gli account di archiviazione e gli hub eventi dispongano di criteri di conservazione che soddisfino le normative sulla privacy aziendale e</span><span class="sxs-lookup"><span data-stu-id="72eb2-172">Ensure storage accounts and Event Hubs have retention policies that meet corporate and government privacy regulations.</span></span> <span data-ttu-id="72eb2-173">Assicurarsi anche di livelli di accesso utente.</span><span class="sxs-lookup"><span data-stu-id="72eb2-173">Also make sure to tier the user access levels.</span></span> <span data-ttu-id="72eb2-174">La suddivisione in livelli garantisce che gli utenti abbiano accesso solo ai dati necessari per il proprio ruolo.</span><span class="sxs-lookup"><span data-stu-id="72eb2-174">Tiering ensures that users only have access to the data they need for their role.</span></span>

## <a name="next-steps"></a><span data-ttu-id="72eb2-175">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="72eb2-175">Next steps</span></span>

<span data-ttu-id="72eb2-176">Per ulteriori informazioni sugli argomenti introdotti in questo articolo:</span><span class="sxs-lookup"><span data-stu-id="72eb2-176">To learn more about the topics introduced in this article:</span></span>

- <span data-ttu-id="72eb2-177">Vedere il [modello di dati a livelli](https://aka.ms/tiereddatadeploy), che viene utilizzato dal modello di rilevamento calpestio.</span><span class="sxs-lookup"><span data-stu-id="72eb2-177">See the [Tiered Data pattern](https://aka.ms/tiereddatadeploy), which is leveraged by the footfall detection pattern.</span></span>
- <span data-ttu-id="72eb2-178">Per altre informazioni sull'uso della visione personalizzata, vedere [visione personalizzata ai Dev Kit](https://azure.github.io/Vision-AI-DevKit-Pages/) .</span><span class="sxs-lookup"><span data-stu-id="72eb2-178">See the [Custom Vision AI Dev Kit](https://azure.github.io/Vision-AI-DevKit-Pages/) to learn more about using custom vision.</span></span> 

<span data-ttu-id="72eb2-179">Quando si è pronti per testare l'esempio di soluzione, continuare con la [Guida alla distribuzione del rilevamento calpestio](solution-deployment-guide-retail-footfall-detection.md).</span><span class="sxs-lookup"><span data-stu-id="72eb2-179">When you're ready to test the solution example, continue with the [Footfall detection deployment guide](solution-deployment-guide-retail-footfall-detection.md).</span></span> <span data-ttu-id="72eb2-180">Questa guida contiene istruzioni dettagliate per la distribuzione e il test dei componenti.</span><span class="sxs-lookup"><span data-stu-id="72eb2-180">The deployment guide provides step-by-step instructions for deploying and testing its components.</span></span>
